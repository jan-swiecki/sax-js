#!/bin/bash
set -eo pipefail

rm -rf dist

esbuild="esbuild \
  --log-level=warning \
  --keep-names \
  --target=node16 \
  --platform=node \
  --outdir=dist"

if [ "$1" == "--for-testing" ]; then
  $esbuild --format=cjs --outdir=dist \
    lib/*.ts \
    test/*.{js,ts} \
    test/stream-tests/*.ts
else
  $esbuild --format=cjs --bundle lib/sax.ts
  # cp package.json dist
  # tsc -m commonjs --esModuleInterop --lib es2017 --declaration --emitDeclarationOnly --outFile dist/sax.d.ts lib/*.ts
  tsc -m commonjs --esModuleInterop --lib es2017 \
    --declaration --declarationMap --sourceMap \
    --emitDeclarationOnly --outDir dist lib/sax.ts
fi
